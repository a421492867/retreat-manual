# 限流算法

*限流  顾名思义 就是限制流量   通过限流  可以很好的控制系统的qps， 从而达到保护系统的目的*

## 计数器算法

*对于A接口来说  我们1分钟的访问次数不能超过100个*

> 在一开始的时候  我们设置一个计数器counter  每当一个请求过来的时候 counter就加1  如果counter的值大于100 并且该请求与第一个请求的间隔时间还在1分钟之内  那么说明请求数过多, 如果该请求与第一个请求的时间间隔大于1分钟 且counter的值还在限流范围内  就重置counter

*此方法会有一个  **临界**问题*

> 假设有一个恶意用户, 0:59时  瞬间发送了100个请求  并且1:00又瞬间发送了100个请求  那么其实这个用户在1秒里 发送了200个请求.  通过滑动窗口算法可解决

### 滑动窗口算法

> 将时间周期分为N个小周期, 分别记录每个小周期内访问次数. 并且根据时间滑动删除过期的小周期
>
> 滑动窗口的格子划分的越多, 那么滑动窗口的滚动就越平滑  限流的统计就会越精确

## 令牌桶算法

> 1.所有的请求在处理之前都需要拿到一个可用的令牌才会被处理
>
> 2.根据限流大小  设置按照一定的速率往桶里添加令牌
>
> 3.桶设置最大的放置令牌限制,当桶满时,新添加的令牌就被丢弃或者拒绝
>
> 4.请求达到后首先要获取令牌桶中的令牌, 拿着令牌才可以进行其他的业务逻辑,处理完业务逻辑之后,将令牌直接删除
>
> 5.令牌桶有最低限额, 当桶中的令牌达到最低限额的时候  请求处理完之后不会删除令牌 以此保证足够的限流

## 漏桶算法

> 可以粗略的认为就是注水漏水的过程  往桶中以一定速率流出睡  以任意速率流入水  当水桶超过桶流量则丢弃. 因为桶容量是不变的,保证了整体的速率